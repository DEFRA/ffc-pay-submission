const getContent = require('../../../../app/batching/get-content')
const { AP, AR } = require('../../../../app/ledgers')
let batch

describe('get content', () => {
  beforeEach(async () => {
    batch = {
      sequence: 1,
      ledger: AP,
      scheme: {
        batchProperties: {
          source: 'SitiELM'
        }
      },
      paymentRequests: [{
        frn: 1234567890,
        marketingYear: 2022,
        deliveryBody: 'RP00',
        currency: 'GBP',
        invoiceNumber: 'SFI12345678',
        agreementNumber: 'SFI12345678',
        contractNumber: 'SIP123456',
        dueDate: '02/08/2021',
        schedule: 'M12',
        originalInvoiceNumber: 'SFI12345678',
        invoiceCorrectionReference: 'SFI87654321',
        recoveryDate: '03/08/2021',
        debtType: 'irr',
        invoiceLines: [{
          fundCode: 'DRD10',
          schemeCode: '80001',
          accountCode: 'SOS273',
          description: 'G00 - Gross value of payment',
          value: 10021
        }, {
          fundCode: 'DRD10',
          schemeCode: '80001',
          accountCode: 'SOS273',
          description: 'P02 - Over declaration penalty',
          value: -2005
        }, {
          fundCode: 'DRD10',
          schemeCode: '80002',
          accountCode: 'SOS274',
          description: 'G00 - Gross value of payment',
          value: 10000
        }, {
          fundCode: 'DRD10',
          schemeCode: '80003',
          accountCode: 'SOS277',
          description: 'G00 - Gross value of payment',
          value: 20
        }, {
          fundCode: 'DRD10',
          schemeCode: '80003',
          accountCode: 'SOS275',
          description: 'P02 - Over declaration penalty',
          value: -10
        }]
      }]
    }
  })

  test('should return as array', async () => {
    const content = await getContent(batch)
    expect(Array.isArray(content)).toBeTruthy()
  })

  test('should include correct content for AP', async () => {
    const content = await getContent(batch)
    expect(content).toStrictEqual([
      [
        'Vendor',
        1234567890,
        '',
        'DRD10',
        '80001',
        2022,
        'RP00',
        'SFI12345678',
        '80.16',
        'GBP',
        'legacy',
        '',
        'SIP123456',
        0,
        '',
        1,
        '',
        '',
        '',
        'BACS_GBP',
        'SitiELM',
        '',
        '0001',
        '',
        '02/08/2021',
        'GBP',
        '',
        '',
        'M12',
        'END'
      ],
      [
        'Ledger',
        'SOS273',
        '',
        'DRD10',
        '80001',
        2022,
        'RP00',
        'SFI12345678',
        '100.21',
        'GBP',
        'legacy',
        '',
        '',
        '',
        1,
        '',
        '',
        'G00 - Gross value of payment',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        'SFI12345678',
        '',
        'END'
      ],
      [
        'Ledger',
        'SOS273',
        '',
        'DRD10',
        '80001',
        2022,
        'RP00',
        'SFI12345678',
        '-20.05',
        'GBP',
        'legacy',
        '',
        '',
        '',
        2,
        '',
        '',
        'P02 - Over declaration penalty',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        'SFI12345678',
        '',
        'END'
      ],
      [
        'Vendor',
        1234567890,
        '',
        'DRD10',
        '80002',
        2022,
        'RP00',
        'SFI12345678',
        '100.00',
        'GBP',
        'legacy',
        '',
        'SIP123456',
        0,
        '',
        1,
        '',
        '',
        '',
        'BACS_GBP',
        'SitiELM',
        '',
        '0001',
        '',
        '02/08/2021',
        'GBP',
        '',
        '',
        'M12',
        'END'
      ],
      [
        'Ledger',
        'SOS274',
        '',
        'DRD10',
        '80002',
        2022,
        'RP00',
        'SFI12345678',
        '100.00',
        'GBP',
        'legacy',
        '',
        '',
        '',
        1,
        '',
        '',
        'G00 - Gross value of payment',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        'SFI12345678',
        '',
        'END'
      ], [
        'Vendor',
        1234567890,
        '',
        'DRD10',
        '80003',
        2022,
        'RP00',
        'SFI12345678',
        '0.10',
        'GBP',
        'legacy',
        '',
        'SIP123456',
        0,
        '',
        1,
        '',
        '',
        '',
        'BACS_GBP',
        'SitiELM',
        '',
        '0001',
        '',
        '02/08/2021',
        'GBP',
        '',
        '',
        'M12',
        'END'
      ],
      [
        'Ledger',
        'SOS277',
        '',
        'DRD10',
        '80003',
        2022,
        'RP00',
        'SFI12345678',
        '0.20',
        'GBP',
        'legacy',
        '',
        '',
        '',
        1,
        '',
        '',
        'G00 - Gross value of payment',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        'SFI12345678',
        '',
        'END'
      ],
      [
        'Ledger',
        'SOS275',
        '',
        'DRD10',
        '80003',
        2022,
        'RP00',
        'SFI12345678',
        '-0.10',
        'GBP',
        'legacy',
        '',
        '',
        '',
        2,
        '',
        '',
        'P02 - Over declaration penalty',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        '',
        'SFI12345678',
        '',
        'END'
      ]
    ])
  })

  test('should include correct content for AR', async () => {
    batch.ledger = AR
    const content = await getContent(batch)
    expect(content).toStrictEqual([
      [
        'H',
        1234567890,
        '',
        'GBP',
        'No',
        'SFI12345678',
        'None',
        '',
        'SitiELM',
        '',
        'SFI12345678',
        'SFI87654321',
        'No',
        1234567890,
        '',
        'GBP',
        '',
        'DRD10',
        '80001',
        2022,
        'RP00',
        'END'
      ],
      [
        'L',
        'G00 - Gross value of payment',
        'SOS273',
        '100.21',
        '',
        '02/08/2021',
        '03/08/2021',
        '',
        '',
        'DRD10',
        '80001',
        2022,
        'RP00',
        '',
        'END'
      ],
      [
        'L',
        'P02 - Over declaration penalty',
        'SOS273',
        '-20.05',
        '',
        '02/08/2021',
        '03/08/2021',
        '',
        '',
        'DRD10',
        '80001',
        2022,
        'RP00',
        '',
        'END'
      ],
      [
        'H',
        1234567890,
        '',
        'GBP',
        'No',
        'SFI12345678',
        'None',
        '',
        'SitiELM',
        '',
        'SFI12345678',
        'SFI87654321',
        'No',
        1234567890,
        '',
        'GBP',
        '',
        'DRD10',
        '80002',
        2022,
        'RP00',
        'END'
      ],
      [
        'L',
        'G00 - Gross value of payment',
        'SOS274',
        '100.00',
        '',
        '02/08/2021',
        '03/08/2021',
        '',
        '',
        'DRD10',
        '80002',
        2022,
        'RP00',
        '',
        'END'
      ], [
        'H',
        1234567890,
        '',
        'GBP',
        'No',
        'SFI12345678',
        'None',
        '',
        'SitiELM',
        '',
        'SFI12345678',
        'SFI87654321',
        'No',
        1234567890,
        '',
        'GBP',
        '',
        'DRD10',
        '80003',
        2022,
        'RP00',
        'END'
      ],
      [
        'L',
        'G00 - Gross value of payment',
        'SOS277',
        '0.20',
        '',
        '02/08/2021',
        '03/08/2021',
        '',
        '',
        'DRD10',
        '80003',
        2022,
        'RP00',
        '',
        'END'
      ],
      [
        'L',
        'P02 - Over declaration penalty',
        'SOS275',
        '-0.10',
        '',
        '02/08/2021',
        '03/08/2021',
        '',
        '',
        'DRD10',
        '80003',
        2022,
        'RP00',
        '',
        'END'
      ]
    ])
  })
})
